{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}Write a Review{% endblock %}

{% block content %}
<div class="page-container">
    <div class="form-card">
        <h2 class="text-primary-green mb-4">Write a Review</h2>
        
        <div class="alert alert-info mb-4">
            <h5 class="alert-heading">Session Details</h5>
            <p class="mb-0">
                Service: <strong>{{ session.service.name }}</strong><br>
                Date: <strong>{{ session.date_time|date:"F j, Y" }}</strong><br>
                Time: <strong>{{ session.date_time|time:"H:i" }}</strong>
            </p>
        </div>

        <form method="post" id="review-form">
            {% csrf_token %}
            
            {% if form.non_field_errors %}
                <div class="alert alert-danger">{{ form.non_field_errors }}</div>
            {% endif %}

            <div class="form-group mb-4">
                <label class="form-label">Rating*</label>
                <div class="star-rating">
                    {% for i in "54321" %}
                    <input type="radio" id="star{{ i }}" name="rating" value="{{ i }}" required>
                    <label for="star{{ i }}" title="{{ i }} stars">
                        <i class="fas fa-star"></i>
                    </label>
                    {% endfor %}
                </div>
                {% if form.rating.errors %}
                    <div class="invalid-feedback d-block">{{ form.rating.errors.0 }}</div>
                {% endif %}
            </div>

            <div class="form-group mb-4">
                {{ form.comment|as_crispy_field }}
            </div>

            <div class="form-actions d-flex justify-content-center gap-3 mt-4">
                <button type="submit" class="btn btn-success">
                    Submit Review
                </button>
                <a href="{% url 'viewer:session_history' %}" class="btn btn-secondary">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
.star-rating {
    display: inline-flex;
    flex-direction: row-reverse;
    font-size: 1.5em;
    justify-content: flex-end;
}

.star-rating input {
    display: none;
}

.star-rating label {
    color: #ddd;
    cursor: pointer;
    padding: 0 0.1em;
    transition: color 0.2s ease-in-out;
}

.star-rating label:hover,
.star-rating label:hover ~ label,
.star-rating input:checked ~ label {
    color: #ffd700;
}

.star-rating label i {
    transition: transform 0.2s ease-in-out;
}

.star-rating label:hover i,
.star-rating label:hover ~ label i,
.star-rating input:checked ~ label i {
    transform: scale(1.2);
}
</style>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('review-form');
    const ratingInputs = form.querySelectorAll('input[name="rating"]');
    
    // Pre-select rating if it exists
    {% if form.rating.value %}
        const rating = {{ form.rating.value }};
        document.getElementById('star' + rating).checked = true;
    {% endif %}
    
    // Validate form before submit
    form.addEventListener('submit', function(e) {
        const rating = form.querySelector('input[name="rating"]:checked');
        if (!rating) {
            e.preventDefault();
            alert('Please select a rating');
        }
    });
});
</script>
{% endblock %} 